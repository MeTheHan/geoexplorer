<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoExplorer - Coƒürafya Oyunu</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .game-container {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .game-container {
                grid-template-columns: 1fr;
            }
        }

        .location-info {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .timer-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .timer {
            background: #e74c3c;
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .round-info {
            background: #3498db;
            color: white;
            padding: 8px 15px;
            border-radius: 15px;
            font-weight: bold;
        }

        .target-location {
            text-align: center;
        }

        .target-location h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .coordinates, .continent {
            margin: 10px 0;
            font-size: 1.1em;
        }

        .game-panel {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .score-display {
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            color: #27ae60;
            margin-bottom: 20px;
        }

        #guessMap {
            width: 100%;
            height: 400px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #27ae60;
            color: white;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .results-container {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .game-stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }

        .stat-card {
            background: #34495e;
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .settings-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåç GeoExplorer</h1>
            <p id="subtitle">D√ºnya Coƒürafyasƒ±nƒ± Ke≈üfet!</p>
        </div>
        
        <div class="game-container">
            <div class="location-info">
                <button class="settings-btn" onclick="openSettings()">‚öôÔ∏è Ayarlar</button>
                
                <div class="timer-container">
                    <div class="timer" id="timer">02:00</div>
                    <div class="round-info">
                        <span id="roundText">Raunt</span> <span id="roundNumber">1</span>/<span id="totalRounds">5</span>
                    </div>
                </div>
                
                <div class="target-location">
                    <h2 id="locationName">-</h2>
                    <div class="coordinates">
                        <strong id="coordinatesText">Koordinatlar:</strong>
                        <span id="coordinatesValue">-</span>
                    </div>
                    <div class="continent">
                        <strong id="continentText">Kƒ±ta:</strong>
                        <span id="continentValue">-</span>
                    </div>
                </div>
            </div>
            
            <div class="game-panel">
                <div class="score-display">
                    <span id="totalScore">0</span> <span id="pointsText">Puan</span>
                </div>
                
                <div id="guessMap"></div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" id="guessBtn" onclick="makeGuess()">
                        üìç <span id="guessText">Tahminimi Onayla</span>
                    </button>
                    <button class="btn btn-secondary" onclick="skipLocation()">
                        ‚è≠Ô∏è <span id="skipText">Ge√ß</span>
                    </button>
                </div>
                
                <div class="results-container" id="resultsContainer">
                    <div class="distance-score" id="distanceScore"></div>
                    <div class="location-details" id="locationDetails"></div>
                </div>
                
                <button class="btn btn-primary" id="nextRoundBtn" onclick="nextRound()" style="display: none; width: 100%;">
                    ‚û°Ô∏è <span id="nextRoundText">Sonraki Raunt</span>
                </button>
                
                <div class="game-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="accuracy">0%</div>
                        <div class="stat-label" id="accuracyText">Doƒüruluk</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgDistance">- km</div>
                        <div class="stat-label" id="distanceText">Ort. Mesafe</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="foundCount">0</div>
                        <div class="stat-label" id="foundText">Bulunan</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // BASƒ∞T ve √áALI≈ûAN KOD
        let map;
        let guessMarker = null;
        let timerInterval;
        let currentLocation = null;
        let playerGuess = null;
        let gameState = {
            currentRound: 1,
            totalScore: 0,
            roundActive: true,
            timer: 120,
            roundScores: [],
            roundDistances: [],
            foundCount: 0,
            totalRounds: 5
        };

        let settings = {
            language: 'tr',
            timerDuration: 120
        };

        // Sayfa y√ºklendiƒüinde
        document.addEventListener('DOMContentLoaded', function() {
            initGame();
        });

        function initGame() {
            initMap();
            startRound();
        }

        function initMap() {
            map = L.map('guessMap').setView([20, 0], 2);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            
            map.on('click', function(e) {
                if (!gameState.roundActive) return;
                
                if (guessMarker) {
                    map.removeLayer(guessMarker);
                }
                
                guessMarker = L.marker(e.latlng).addTo(map)
                    .bindPopup(`üìç Tahmininiz: ${e.latlng.lat.toFixed(4)}, ${e.latlng.lng.toFixed(4)}`)
                    .openPopup();
                
                playerGuess = e.latlng;
                document.getElementById('guessBtn').disabled = false;
            });
        }

        function generateRandomLocation() {
            // GER√áEKTEN RASTGELE koordinatlar
            const lat = (Math.random() * 160 - 80).toFixed(4);  // -80 ile +80 arasƒ±
            const lng = (Math.random() * 360 - 180).toFixed(4); // -180 ile +180 arasƒ±
            
            return {
                lat: parseFloat(lat),
                lng: parseFloat(lng),
                name: `Rastgele Konum (${lat}, ${lng})`,
                continent: 'D√ºnya'
            };
        }

        function startRound() {
            gameState.roundActive = true;
            playerGuess = null;
            gameState.timer = settings.timerDuration;
            
            // YENƒ∞ RASTGELE LOKASYON
            currentLocation = generateRandomLocation();
            
            // EKRANDA G√ñSTER
            document.getElementById('locationName').textContent = currentLocation.name;
            document.getElementById('coordinatesValue').textContent = `${currentLocation.lat}, ${currentLocation.lng}`;
            document.getElementById('continentValue').textContent = currentLocation.continent;
            
            // HARƒ∞TAYI SIFIRLA
            if (guessMarker) {
                map.removeLayer(guessMarker);
                guessMarker = null;
            }
            map.setView([20, 0], 2);
            
            // BUTONLARI SIFIRLA
            document.getElementById('guessBtn').disabled = true;
            document.getElementById('resultsContainer').style.display = 'none';
            document.getElementById('nextRoundBtn').style.display = 'none';
            document.getElementById('guessBtn').style.display = 'block';
            
            // ZAMANLAYICI
            startTimer();
            
            // RAUNT Bƒ∞LGƒ∞Sƒ∞
            document.getElementById('roundNumber').textContent = gameState.currentRound;
            document.getElementById('totalRounds').textContent = gameState.totalRounds;
        }

        function startTimer() {
            updateTimerDisplay();
            
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                gameState.timer--;
                updateTimerDisplay();
                
                if (gameState.timer <= 0) {
                    clearInterval(timerInterval);
                    if (gameState.roundActive) {
                        makeGuess();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(gameState.timer / 60);
            const seconds = gameState.timer % 60;
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function makeGuess() {
            if (!playerGuess || !gameState.roundActive) return;
            
            gameState.roundActive = false;
            clearInterval(timerInterval);
            
            const distance = calculateDistance(
                playerGuess.lat, playerGuess.lng,
                currentLocation.lat, currentLocation.lng
            );
            
            const score = calculateScore(distance);
            gameState.totalScore += score;
            gameState.roundScores.push(score);
            gameState.roundDistances.push(distance);
            gameState.foundCount++;
            
            showResults(distance, score);
            updateStats();
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                    Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function calculateScore(distance) {
            if (distance < 100) return 5000;
            if (distance < 500) return 4000;
            if (distance < 1000) return 3000;
            if (distance < 2000) return 2000;
            if (distance < 5000) return 1000;
            return 500;
        }

        function showResults(distance, score) {
            const resultsContainer = document.getElementById('resultsContainer');
            const distanceScore = document.getElementById('distanceScore');
            const locationDetails = document.getElementById('locationDetails');
            
            distanceScore.innerHTML = `
                <span style="color: ${score > 2500 ? '#27ae60' : score > 1000 ? '#f39c12' : '#e74c3c'};">
                    ${score} Puan ‚Ä¢ ${distance.toFixed(1)} km uzakta
                </span>
            `;
            locationDetails.innerHTML = `
                <strong>Ger√ßek Konum: ${currentLocation.name}</strong>
            `;
            
            // Ger√ßek konumu haritada g√∂ster
            L.marker([currentLocation.lat, currentLocation.lng], {
                icon: new L.Icon({
                    iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
                    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [1, -34],
                    shadowSize: [41, 41]
                })
            }).addTo(map).bindPopup(`üéØ Ger√ßek Konum: ${currentLocation.name}`).openPopup();
            
            resultsContainer.style.display = 'block';
            document.getElementById('guessBtn').style.display = 'none';
            document.getElementById('nextRoundBtn').style.display = 'block';
        }

        function skipLocation() {
            if (!gameState.roundActive) return;
            gameState.roundActive = false;
            clearInterval(timerInterval);
            
            showResults(0, 0);
            updateStats();
        }

        function nextRound() {
            gameState.currentRound++;
            
            if (gameState.currentRound > gameState.totalRounds) {
                endGame();
            } else {
                startRound();
            }
        }

        function endGame() {
            const avgDistance = calculateAverageDistance();
            const accuracy = calculateAccuracy();
            
            alert(`üéâ Oyun Tamamlandƒ±!\n\nFinal Skorun: ${gameState.totalScore}\nOrtalama Mesafe: ${avgDistance.toFixed(1)} km\nDoƒüruluk Oranƒ±: ${accuracy}%`);
            
            // Oyunu sƒ±fƒ±rla
            gameState = {
                currentRound: 1,
                totalScore: 0,
                roundActive: true,
                timer: 120,
                roundScores: [],
                roundDistances: [],
                foundCount: 0,
                totalRounds: 5
            };
            
            updateStats();
            startRound();
        }

        function updateStats() {
            document.getElementById('totalScore').textContent = gameState.totalScore;
            document.getElementById('accuracy').textContent = calculateAccuracy() + '%';
            document.getElementById('avgDistance').textContent = calculateAverageDistance().toFixed(1) + ' km';
            document.getElementById('foundCount').textContent = gameState.foundCount;
        }

        function calculateAccuracy() {
            if (gameState.roundScores.length === 0) return 0;
            const avgScore = gameState.roundScores.reduce((a, b) => a + b, 0) / gameState.roundScores.length;
            return Math.round((avgScore / 5000) * 100);
        }

        function calculateAverageDistance() {
            if (gameState.roundDistances.length === 0) return 0;
            return gameState.roundDistances.reduce((a, b) => a + b, 0) / gameState.roundDistances.length;
        }

        function openSettings() {
            alert('Ayarlar men√ºs√º - Basit versiyonda aktif deƒüil');
        }
    </script>
</body>
</html>
